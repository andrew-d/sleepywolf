package main

const gatherTemplate = `
// DO NOT EDIT!!!
// This code was generated by github.com/andrew-d/sleepywolf

package main

import (
	"os"

	"github.com/andrew-d/sleepywolf/gather"

	// This is the package we're introspecting
	"{{.ImportPath}}"
)

{{$pn := .PackageName}}

func main() {
	g := gather.NewInfoGatherer()
{{range .StructNames}}
	g.Register("{{.}}", &{{$pn}}.{{.}}{})
{{end}}
	g.Run(os.Stdout)
}
`

const finalTemplate = `
// This code was generated by github.com/andrew-d/sleepywolf

package {{.PackageName}}

import (
	"net/http"

	"github.com/zenazn/goji/web"
)

{{$prefix := .UrlPrefix}}

{{range .Structs}}
func (self *{{.StructName}}) RegisterOn(mux *web.Mux) {
	{{$struct := .}}
	{{range .Handlers}}
		handlerFor{{.Name}} := func(c web.C, w http.ResponseWriter, r *http.Request) {
			{{if $struct.HasBeforeAll}}
			if !self.Before(c, w, r) {
				return
			}
			{{end}}

			{{if .Params | eq 3}} self.{{.Name}}(c, w, r) {{else}} self.{{.Name}}(w, r) {{end}}
		}
		mux.{{RegisterFuncFor .Name}}("{{$prefix}}/{{UrlFor $struct.StructName .Name}}", handlerFor{{.Name}})
	{{end}}
}
{{end}}
`
